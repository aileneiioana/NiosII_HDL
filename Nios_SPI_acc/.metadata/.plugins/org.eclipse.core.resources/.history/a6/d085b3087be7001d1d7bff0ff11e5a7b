#include "altera_up_avalon_accelerometer_spi.h"
#include "system.h"
#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <stdint.h>

int main(void){
	// define a pointer of type pixel_buffer...
	// to use as a reference in the dma functions
	//
	alt_up_accelerometer_spi_dev * acc_dev;

	// open the Pixel Buffer port
	//  - command is in drivers/inc/alter...video_pixel_buffer_dma.h
	// name reference is in system.h
	//  - "/dev/video_pixel_buffer_dma_0"
	//
	acc_dev = alt_up_accelerometer_spi_open_dev ("/dev/accelerometer_spi_0");

	// Check for error and output to the console
	//
	if ( acc_dev == NULL)
	printf ("Error: could not acc device \n");
	else
	printf ("Opened acc device \n");

	//
	// Attempts to debug
	//
	int foo, boo, loo;
	alt_u8 test = 0;
	foo = alt_up_accelerometer_spi_write(acc_dev, 0x21008, 0x40);
	usleep(100000);	// 1sec
	boo = alt_up_accelerometer_spi_read(acc_dev, 0x21008, &test);
	test = alt_up_accelerometer_spi_read_address_register(acc_dev, 0x21008);
	usleep(100000);	// 1sec
	printf("test: %i\n", test);
	printf("foo: %i\n", foo);

	// original code
	//
	// accelerometer is supposed to reset enabled in +/- 2g mode

	while(1){
		alt_32 datax,xx = 0;
		xx = alt_up_accelerometer_spi_read_x_axis(acc_dev, &datax);


		printf("X is : %i\n", datax);

		usleep(1000000);	// 10sec
	}




	return 0;
}
